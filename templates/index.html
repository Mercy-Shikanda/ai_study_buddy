<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Study Buddy - Flashcard Generator</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1><i class="fas fa-brain"></i> AI Study Buddy</h1>
      <p class="subtitle">Transform your study notes into interactive flashcards using AI</p>
    </header>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Notes Input Section -->
      <section class="input-section">
        <h2><i class="fas fa-file-text"></i> Paste Your Study Notes</h2>
        <div class="input-container">
          <textarea id="notes" placeholder="Paste your study notes here and let AI generate 5 quiz questions for you..."></textarea>
          <button id="generateBtn" onclick="generateFlashcards()">
            <i class="fas fa-magic"></i> Generate 5 Quiz Questions
          </button>
        </div>
      </section>

      <!-- Navigation Tabs -->
      <div class="tab-container">
        <button class="tab-btn active" onclick="showTab('new')">
          <i class="fas fa-plus"></i> New Flashcards
        </button>
        <button class="tab-btn" onclick="showTab('previous')">
          <i class="fas fa-history"></i> Previous Flashcards
        </button>
      </div>

      <!-- New Flashcards Section -->
      <section id="new-tab" class="tab-content active">
        <div id="flashcards" class="flashcards">
          <div class="empty-state">
            <i class="fas fa-lightbulb"></i>
            <p>Generate your first set of flashcards!</p>
          </div>
        </div>
      </section>

      <!-- Previous Flashcards Section -->
      <section id="previous-tab" class="tab-content">
        <div class="controls">
          <button onclick="loadPreviousFlashcards()" class="load-btn">
            <i class="fas fa-refresh"></i> Load Previous Flashcards
          </button>
        </div>
        <div id="previous-flashcards" class="flashcards">
          <div class="empty-state">
            <i class="fas fa-archive"></i>
            <p>No previous flashcards found. Generate some first!</p>
          </div>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>Powered by <i class="fas fa-robot"></i> Hugging Face AI | Built with <i class="fas fa-heart"></i> for students</p>
    </footer>
  </div>

  <script>
    let currentUserId = "aebef574-006b-4231-8880-362dce742514";

    // Tab functionality
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });

      // Show selected tab
      document.getElementById(tabName + '-tab').classList.add('active');
      event.target.classList.add('active');
    }

    async function generateFlashcards() {
      const notes = document.getElementById("notes").value;

      if (!notes) {
        alert("Please paste some study notes first!");
        return;
      }

      // Show loading state
      const button = document.getElementById("generateBtn");
      const originalHTML = button.innerHTML;
      button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
      button.disabled = true;

      try {
        const response = await fetch("/generate", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ 
            notes, 
            user_id: currentUserId
          })
        });

        const result = await response.json();
        
        if (result.error) {
          alert("Error: " + result.error);
          return;
        }

        // Update user ID if provided
        if (result.user_id) {
          currentUserId = result.user_id;
        }

        const flashcards = result.flashcards || result;
        displayFlashcards(flashcards, 'flashcards');

      } catch (error) {
        console.error("Error:", error);
        alert("Failed to generate flashcards. Please try again.");
      } finally {
        // Reset button state
        button.innerHTML = originalHTML;
        button.disabled = false;
      }
    }

    async function loadPreviousFlashcards() {
      const button = event.target;
      const originalHTML = button.innerHTML;
      button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
      button.disabled = true;

      try {
        const response = await fetch(`/flashcards/recent/${currentUserId}`);
        const result = await response.json();
        
        if (result.error) {
          alert("Error: " + result.error);
          return;
        }

        const flashcards = result.flashcards || [];
        displayFlashcards(flashcards, 'previous-flashcards');

      } catch (error) {
        console.error("Error:", error);
        alert("Failed to load previous flashcards.");
      } finally {
        button.innerHTML = originalHTML;
        button.disabled = false;
      }
    }

    function displayFlashcards(flashcards, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";

      if (flashcards.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-exclamation-circle"></i>
            <p>No flashcards found. Try generating some first!</p>
          </div>
        `;
        return;
      }

      flashcards.forEach((fc, index) => {
        const card = document.createElement("div");
        card.className = "flashcard";
        card.style.animationDelay = `${index * 0.1}s`;
        card.innerHTML = `
          <div class="inner">
            <div class="front">
              <div class="card-number">${index + 1}</div>
              <div class="question">${fc.question}</div>
            </div>
            <div class="back">
              <div class="answer">${fc.answer}</div>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // Load previous flashcards on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Auto-load recent flashcards in the background
      fetch(`/flashcards/recent/${currentUserId}`)
        .then(response => response.json())
        .then(result => {
          if (result.flashcards && result.flashcards.length > 0) {
            // Just cache them, don't display until user clicks the tab
            console.log(`Found ${result.flashcards.length} previous flashcards`);
          }
        })
        .catch(error => console.log("No previous flashcards found"));
    });
  </script>
</body>
</html>
